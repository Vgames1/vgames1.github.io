<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBSVÂ¬Text Translator</title>
    <link rel="icon" href="https://www.tbvs.run.place/cdn/favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0e7ff; /* Lighter blue background */
            background-image: radial-gradient(at 0% 0%, hsla(210,100%,90%,1) 0, transparent 50%),
                              radial-gradient(at 100% 100%, hsla(270,100%,90%,1) 0, transparent 50%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            width: 95%; /* Make it slightly more fluid */
            margin: 20px auto; /* Adjust margin for better centering */
            padding: 30px;
            background-color: #ffffff;
            border-radius: 16px; /* More rounded corners */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15); /* Stronger shadow */
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        textarea {
            min-height: 150px;
            resize: vertical;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        textarea:focus {
            outline: none;
            border-color: #6366f1; /* Indigo-500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3); /* Indigo-500 shadow */
        }
        button {
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .read-aloud-button {
            background-color: #4CAF50; /* Green */
            background-image: linear-gradient(to right, #4CAF50, #66BB6A);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }
        .read-aloud-button:hover {
            background-image: linear-gradient(to right, #45a049, #5cb85c);
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
        }
        .read-aloud-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(76, 175, 80, 0.2);
        }
        .stop-read-aloud-button {
            background-color: #f44336; /* Red */
            background-image: linear-gradient(to right, #f44336, #ef5350);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }
        .stop-read-aloud-button:hover {
            background-image: linear-gradient(to right, #d32f2f, #e57373);
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(244, 67, 54, 0.4);
        }
        .stop-read-aloud-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(244, 67, 54, 0.2);
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Universal Translator</h1>

        <div class="mb-6">
            <label for="inputText" class="block text-gray-700 text-lg font-medium mb-2">Enter Text to Translate:</label>
            <textarea id="inputText" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800 text-base shadow-sm" placeholder="Type your text here..."></textarea>
        </div>

        <div class="mb-8 flex flex-col sm:flex-row items-center justify-between gap-4">
            <div class="w-full sm:w-1/2">
                <label for="targetLanguage" class="block text-gray-700 text-lg font-medium mb-2">Choose Language:</label>
                <select id="targetLanguage" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-blue-500 focus:border-blue-500 text-gray-800 text-base shadow-sm" aria-label="Select target language for translation">
                    <!-- Language options will be populated by JavaScript -->
                </select>
            </div>
            <button id="translateButton" class="w-full sm:w-auto px-8 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-lg shadow-md hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center" aria-live="polite">
                <span id="buttonText">Translate Text</span>
                <div id="loadingSpinner" class="loading-spinner ml-3"></div>
            </button>
        </div>

        <div class="mb-6">
            <label for="translatedText" class="block text-gray-700 text-lg font-medium mb-2">Translated Text:</label>
            <div id="translatedText" class="w-full p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-gray-800 text-base min-h-[150px] overflow-auto shadow-inner" aria-live="polite">
                Your translated text will appear here.
            </div>
            <div class="flex justify-end mt-4 gap-2">
                <button id="readAloudButton" class="read-aloud-button hidden" aria-label="Read translated text aloud">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                        <path fill-rule="evenodd" d="M11.47 2.47a.75.75 0 0 1 1.06 0l3.75 3.75a.75.75 0 0 1 0 1.06L13.25 10.25a.75.75 0 0 1-1.06 0L8.75 6.25a.75.75 0 0 1 0-1.06l3.75-3.75ZM12 4.5v7.5a.75.75 0 0 1-1.5 0V4.5a.75.75 0 0 1 1.5 0Zm.75 14.75a.75.75 0 0 0-1.5 0v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75v-.008ZM12 15a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75.75.75 0 0 1-.75-.75v-.008A.75.75 0 0 1 12 15Zm.75 2.25a.75.75 0 0 0-1.5 0v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75v-.008Z" clip-rule="evenodd" />
                        <path d="M12 1.5a.75.75 0 0 1 .75.75V15a.75.75 0 0 1-1.5 0V2.25A.75.75 0 0 1 12 1.5ZM12 16.5a.75.75 0 0 0-1.5 0v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V16.5ZM12 18a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75.75.75 0 0 1-.75-.75v-.008A.75.75 0 0 1 12 18Zm.75 2.25a.75.75 0 0 0-1.5 0v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75v-.008Z" />
                        <path fill-rule="evenodd" d="M11.47 2.47a.75.75 0 0 1 1.06 0l3.75 3.75a.75.75 0 0 1 0 1.06L13.25 10.25a.75.75 0 0 1-1.06 0L8.75 6.25a.75.75 0 0 1 0-1.06l3.75-3.75ZM12 4.5v7.5a.75.75 0 0 1-1.5 0V4.5a.75.75 0 0 1 1.5 0Zm.75 14.75a.75.75 0 0 0-1.5 0v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75v-.008ZM12 15a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75.75.75 0 0 1-.75-.75v-.008A.75.75 0 0 1 12 15Zm.75 2.25a.75.75 0 0 0-1.5 0v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75v-.008Z" clip-rule="evenodd" />
                    </svg>
                    <span>Read Aloud</span>
                </button>
                <button id="stopReadAloudButton" class="stop-read-aloud-button hidden" aria-label="Stop reading aloud">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                        <path fill-rule="evenodd" d="M4.5 7.5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-9a3 3 0 0 1-3-3v-9Z" clip-rule="evenodd" />
                    </svg>
                    <span>Stop</span>
                </button>
            </div>
        </div>

        <div id="errorMessage" class="text-red-600 text-center mt-4 hidden" role="alert"></div>
    </div>

    <script type="module">
        const inputText = document.getElementById('inputText');
        const targetLanguageSelect = document.getElementById('targetLanguage');
        const translateButton = document.getElementById('translateButton');
        const translatedTextDiv = document.getElementById('translatedText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const buttonText = document.getElementById('buttonText');
        const errorMessageDiv = document.getElementById('errorMessage');
        const readAloudButton = document.getElementById('readAloudButton');
        const stopReadAloudButton = document.getElementById('stopReadAloudButton');

        let currentUtterance = null; 

        const languages = [
            { code: 'af', name: 'Afrikaans' },
            { code: 'sq', name: 'Albanian' },
            { code: 'am', name: 'Amharic' },
            { code: 'ar', name: 'Arabic' },
            { code: 'hy', name: 'Armenian' },
            { code: 'az', name: 'Azerbaijani' },
            { code: 'eu', name: 'Basque' },
            { code: 'be', name: 'Belarusian' },
            { code: 'bn', name: 'Bengali' },
            { code: 'bs', name: 'Bosnian' },
            { code: 'bg', name: 'Bulgarian' },
            { code: 'ca', name: 'Catalan' },
            { code: 'ceb', name: 'Cebuano' },
            { code: 'zh-CN', name: 'Chinese (Simplified)' },
            { code: 'zh-TW', name: 'Chinese (Traditional)' },
            { code: 'co', name: 'Corsican' },
            { code: 'hr', name: 'Croatian' },
            { code: 'cs', name: 'Czech' },
            { code: 'da', name: 'Danish' },
            { code: 'nl', name: 'Dutch' },
            { code: 'en', name: 'English' },
            { code: 'eo', name: 'Esperanto' },
            { code: 'et', name: 'Estonian' },
            { code: 'fi', name: 'Finnish' },
            { code: 'fr', name: 'French' },
            { code: 'fy', name: 'Frisian' },
            { code: 'gl', name: 'Galician' },
            { code: 'ka', name: 'Georgian' },
            { code: 'de', name: 'German' },
            { code: 'el', name: 'Greek' },
            { code: 'gu', name: 'Gujarati' },
            { code: 'ht', name: 'Haitian Creole' },
            { code: 'ha', name: 'Hausa' },
            { code: 'haw', name: 'Hawaiian' },
            { code: 'he', name: 'Hebrew' },
            { code: 'hi', name: 'Hindi' },
            { code: 'hmn', name: 'Hmong' },
            { code: 'hu', name: 'Hungarian' },
            { code: 'is', name: 'Icelandic' },
            { code: 'ig', name: 'Igbo' },
            { code: 'id', name: 'Indonesian' },
            { code: 'ga', name: 'Irish' },
            { code: 'it', name: 'Italian' },
            { code: 'ja', name: 'Japanese' },
            { code: 'jw', name: 'Javanese' },
            { code: 'kn', name: 'Kannada' },
            { code: 'kk', name: 'Kazakh' },
            { code: 'km', name: 'Khmer' },
            { code: 'rw', name: 'Kinyarwanda' },
            { code: 'ko', name: 'Korean' },
            { code: 'ku', name: 'Kurdish (Kurmanji)' },
            { code: 'ky', name: 'Kyrgyz' },
            { code: 'lo', name: 'Lao' },
            { code: 'la', name: 'Latin' },
            { code: 'lv', name: 'Latvian' },
            { code: 'lt', name: 'Lithuanian' },
            { code: 'lb', name: 'Luxembourgish' },
            { code: 'mk', name: 'Macedonian' },
            { code: 'mg', name: 'Malagasy' },
            { code: 'ms', name: 'Malay' },
            { code: 'ml', name: 'Malayalam' },
            { code: 'mt', name: 'Maltese' },
            { code: 'mi', name: 'Maori' },
            { code: 'mr', name: 'Marathi' },
            { code: 'mn', name: 'Mongolian' },
            { code: 'my', name: 'Myanmar (Burmese)' },
            { code: 'ne', name: 'Nepali' },
            { code: 'no', name: 'Norwegian' },
            { code: 'ny', name: 'Nyanja (Chichewa)' },
            { code: 'or', name: 'Odia (Oriya)' },
            { code: 'ps', name: 'Pashto' },
            { code: 'fa', name: 'Persian' },
            { code: 'pl', name: 'Polish' },
            { code: 'pt', name: 'Portuguese (Portugal, Brazil)' },
            { code: 'pa', name: 'Punjabi' },
            { code: 'ro', name: 'Romanian' },
            { code: 'ru', name: 'Russian' },
            { code: 'sm', name: 'Samoan' },
            { code: 'gd', name: 'Scots Gaelic' },
            { code: 'sr', name: 'Serbian' },
            { code: 'st', name: 'Sesotho' },
            { code: 'sn', name: 'Shona' },
            { code: 'sd', name: 'Sindhi' },
            { code: 'si', name: 'Sinhala (Sinhalese)' },
            { code: 'sk', name: 'Slovak' },
            { code: 'sl', name: 'Slovenian' },
            { code: 'so', name: 'Somali' },
            { code: 'es', name: 'Spanish' },
            { code: 'su', name: 'Sundanese' },
            { code: 'sw', name: 'Swahili' },
            { code: 'sv', name: 'Swedish' },
            { code: 'tl', name: 'Tagalog (Filipino)' },
            { code: 'tg', name: 'Tajik' },
            { code: 'ta', name: 'Tamil' },
            { code: 'tt', name: 'Tatar' },
            { code: 'te', name: 'Telugu' },
            { code: 'th', name: 'Thai' },
            { code: 'tr', name: 'Turkish' },
            { code: 'tk', name: 'Turkmen' },
            { code: 'uk', name: 'Ukrainian' },
            { code: 'ur', name: 'Urdu' },
            { code: 'ug', name: 'Uyghur' },
            { code: 'uz', name: 'Uzbek' },
            { code: 'vi', name: 'Vietnamese' },
            { code: 'cy', name: 'Welsh' },
            { code: 'xh', name: 'Xhosa' },
            { code: 'yi', name: 'Yiddish' },
            { code: 'yo', name: 'Yoruba' },
            { code: 'zu', name: 'Zulu' }
        ];

        function populateLanguages() {
            languages.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang.code;
                option.textContent = lang.name;
                targetLanguageSelect.appendChild(option);
            });
            targetLanguageSelect.value = 'en';
        }

        populateLanguages();

        function speakText(text, lang) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();

                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = lang; // Set language for better pronunciation

                currentUtterance.onend = () => {
                    readAloudButton.classList.remove('hidden');
                    stopReadAloudButton.classList.add('hidden');
                };
                currentUtterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event.error);
                    errorMessageDiv.textContent = 'Speech synthesis failed. Your browser might not support this language or has an issue.';
                    errorMessageDiv.classList.remove('hidden');
                    readAloudButton.classList.remove('hidden');
                    stopReadAloudButton.classList.add('hidden');
                };

                window.speechSynthesis.speak(currentUtterance);
                readAloudButton.classList.add('hidden');
                stopReadAloudButton.classList.remove('hidden');
            } else {
                errorMessageDiv.textContent = 'Text-to-speech not supported in this browser.';
                errorMessageDiv.classList.remove('hidden');
            }
        }

        function stopSpeaking() {
            if ('speechSynthesis' in window && currentUtterance) {
                window.speechSynthesis.cancel();
                readAloudButton.classList.remove('hidden');
                stopReadAloudButton.classList.add('hidden');
            }
        }

        translateButton.addEventListener('click', async () => {
            const textToTranslate = inputText.value.trim();
            const targetLang = targetLanguageSelect.value;

            stopSpeaking();

            errorMessageDiv.textContent = '';
            errorMessageDiv.classList.add('hidden');
            translatedTextDiv.textContent = '';
            readAloudButton.classList.add('hidden');

            if (!textToTranslate) {
                translatedTextDiv.textContent = 'Please enter some text to translate.';
                return;
            }

            buttonText.textContent = 'Translating...';
            loadingSpinner.style.display = 'block';
            translateButton.disabled = true;

            try {
                const prompt = `Provide ONLY the translated text for the following. Do not include any introductory phrases, explanations, or the original text. Just the translation.\n\nTranslate "${textToTranslate}" into ${targetLanguageSelect.options[targetLanguageSelect.selectedIndex].text} (language code: ${targetLang}).`;

                const chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };

                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const translatedText = result.candidates[0].content.parts[0].text.trim();
                    translatedTextDiv.textContent = translatedText;
                    if (translatedText) { 
                        readAloudButton.classList.remove('hidden');
                    }
                } else {
                    translatedTextDiv.textContent = 'Translation failed: No valid response from API.';
                    errorMessageDiv.textContent = 'Could not get a valid translation. Please try again.';
                    errorMessageDiv.classList.remove('hidden');
                }

            } catch (error) {
                console.error('Translation error:', error);
                translatedTextDiv.textContent = 'An error occurred during translation.';
                errorMessageDiv.textContent = `Error: ${error.message}. Please try again.`;
                errorMessageDiv.classList.remove('hidden');
            } finally {
                buttonText.textContent = 'Translate Text';
                loadingSpinner.style.display = 'none';
                translateButton.disabled = false;
            }
        });

        readAloudButton.addEventListener('click', () => {
            const textToSpeak = translatedTextDiv.textContent;
            const targetLang = targetLanguageSelect.value;
            if (textToSpeak && textToSpeak !== 'Your translated text will appear here.' && textToSpeak !== 'Translation failed: No valid response from API.' && textToSpeak !== 'An error occurred during translation.') {
                speakText(textToSpeak, targetLang);
            } else {
                errorMessageDiv.textContent = 'Nothing to read aloud. Please translate some text first.';
                errorMessageDiv.classList.remove('hidden');
            }
        });

        stopReadAloudButton.addEventListener('click', stopSpeaking);
    </script>
</body>
</html>
